# ç»Ÿä¸€å¤šæ•°æ®æºæ•°æ®è·å–å™¨ä½¿ç”¨æŒ‡å— - Aè‚¡ä¸“ç”¨

## æ¦‚è¿°

`data_fetcher_unified.py` æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å¤šæ•°æ®æºæ•°æ®è·å–å™¨,ä¸“é—¨ç”¨äºAè‚¡æ•°æ®è·å–,å…·æœ‰æ™ºèƒ½å›é€€æœºåˆ¶ã€‚

### æ”¯æŒçš„æ•°æ®æº

1. **Tushare** - Aè‚¡æ•°æ®(éœ€è¦Token,æ•°æ®è´¨é‡é«˜)
2. **yfinance** - Aè‚¡æ•°æ®(å…è´¹,é€šè¿‡Yahoo Finance)
3. **pandas-datareader** - Aè‚¡æ•°æ®(å…è´¹,é€šè¿‡Yahoo Finance)
4. **AKShare** - Aè‚¡æ•°æ®(å…è´¹,ä¸“ä¸ºAè‚¡è®¾è®¡)

## ç‰¹æ€§

- âœ… **æ™ºèƒ½å›é€€æœºåˆ¶**: å¦‚æœä¸€ä¸ªæ•°æ®æºå¤±è´¥,è‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ª
- âœ… **Aè‚¡ä¸“ç”¨**: æ‰€æœ‰æ•°æ®æºéƒ½é’ˆå¯¹Aè‚¡ä¼˜åŒ–
- âœ… **å‡çº¿æ•°æ®**: è‡ªåŠ¨è®¡ç®—MA5, MA10, MA20, MA60
- âœ… **è´¢åŠ¡æ•°æ®**: è·å–EPSç­‰è´¢åŠ¡æŒ‡æ ‡
- âœ… **æ··åˆä½¿ç”¨**: ä»·æ ¼æ•°æ®å’Œè´¢åŠ¡æ•°æ®å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æº
- âœ… **å®¹é”™æ€§å¼º**: å³ä½¿éƒ¨åˆ†APIä¸å¯ç”¨,ç³»ç»Ÿä»èƒ½æ­£å¸¸å·¥ä½œ

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

éœ€è¦çš„åŒ…:
- `tushare>=1.2.89` - Tushare
- `yfinance>=0.2.0` - yfinance
- `pandas-datareader>=0.10.0` - pandas-datareader
- `akshare>=1.12.0` - AKShare

## é…ç½®API Key

### æ–¹æ³•1: ç¯å¢ƒå˜é‡(æ¨è)

```bash
# Windows PowerShell
$env:TUSHARE_TOKEN="your_tushare_token"

# Linux/Mac
export TUSHARE_TOKEN="your_tushare_token"
```

### æ–¹æ³•2: ä»£ç ä¸­ä¼ å…¥

```python
from data_fetcher_unified import UnifiedDataFetcher

fetcher = UnifiedDataFetcher(tushare_token="your_token")
```

**æ³¨æ„**: yfinanceã€pandas-datareaderå’ŒAKShareä¸éœ€è¦API Key,å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

## åŸºæœ¬ä½¿ç”¨

### ç¤ºä¾‹1: è·å–Aè‚¡æ•°æ®(è‡ªåŠ¨å›é€€)

```python
from data_fetcher_unified import UnifiedDataFetcher

# åˆå§‹åŒ–(ä¼šè‡ªåŠ¨å°è¯•æ‰€æœ‰å¯ç”¨çš„æ•°æ®æº)
fetcher = UnifiedDataFetcher()

# è·å–æ•°æ®(è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®æº)
df, code, info = fetcher.fetch_complete_data("å¹³å®‰é“¶è¡Œ", lookback_weeks=120)

print(f"æ•°æ®æ¥æº: {info}")
print(df.head())
print(f"åŒ…å«å‡çº¿: {df.columns.tolist()}")
```

### ç¤ºä¾‹2: æŒ‡å®šä¼˜å…ˆæ•°æ®æº

```python
fetcher = UnifiedDataFetcher(
    preferred_sources=['tushare', 'yfinance', 'akshare']
)
```

### ç¤ºä¾‹3: ä½¿ç”¨è‚¡ç¥¨ä»£ç 

```python
# ä½¿ç”¨6ä½è‚¡ç¥¨ä»£ç 
df, code, info = fetcher.fetch_complete_data("000001", lookback_weeks=120)
```

## æ•°æ®æ ¼å¼

è¿”å›çš„DataFrameåŒ…å«ä»¥ä¸‹åˆ—:

- `date`: æ—¥æœŸ
- `P_t`: æ”¶ç›˜ä»·
- `vol`: æˆäº¤é‡
- `MA5`: 5å‘¨å‡çº¿
- `MA10`: 10å‘¨å‡çº¿
- `MA20`: 20å‘¨å‡çº¿
- `MA60`: 60å‘¨å‡çº¿
- `F_t`: åŸºæœ¬é¢æ•°æ®(é€šå¸¸æ˜¯EPSæˆ–ä»·æ ¼ç§»åŠ¨å¹³å‡)

## ä½¿ç”¨åˆ†æè„šæœ¬

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# åŸºæœ¬ä½¿ç”¨(è‡ªåŠ¨å›é€€)
python analyze_stock_unified.py --stock å¹³å®‰é“¶è¡Œ --weeks 120

# æŒ‡å®šä¼˜å…ˆæ•°æ®æº
python analyze_stock_unified.py --stock å¹³å®‰é“¶è¡Œ --preferred-sources tushare akshare

# ä½¿ç”¨è‚¡ç¥¨ä»£ç 
python analyze_stock_unified.py --stock 000001 --weeks 120

# æŒ‡å®šTushare Token
python analyze_stock_unified.py --stock å¹³å®‰é“¶è¡Œ --tushare-token your_token
```

### Pythonä»£ç ä¸­ä½¿ç”¨

```python
from analyze_stock_unified import analyze_with_unified_fetcher

analyze_with_unified_fetcher(
    stock_name="å¹³å®‰é“¶è¡Œ",
    lookback_weeks=120,
    save_dir="results"
)
```

## æ•°æ®æºé€‰æ‹©é€»è¾‘

ç³»ç»ŸæŒ‰ç…§ä»¥ä¸‹é¡ºåºå°è¯•æ•°æ®æº:

1. **é»˜è®¤é¡ºåº**: Tushare â†’ yfinance â†’ pandas-datareader â†’ AKShare
2. **å¯è‡ªå®šä¹‰**: é€šè¿‡`preferred_sources`å‚æ•°æŒ‡å®šä¼˜å…ˆçº§
3. **è‡ªåŠ¨å›é€€**: å¦‚æœä¸€ä¸ªæ•°æ®æºå¤±è´¥,è‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ª
4. **è´¢åŠ¡æ•°æ®**: ä¼˜å…ˆä½¿ç”¨ä»·æ ¼æ•°æ®ç›¸åŒçš„æº,å¤±è´¥åˆ™å°è¯•å…¶ä»–æº

## æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯æ‰€æœ‰API:

```bash
python test_unified_fetcher.py
```

æµ‹è¯•è„šæœ¬ä¼š:
- æ£€æŸ¥æ‰€æœ‰æ•°æ®æºçš„å¯ç”¨æ€§
- æµ‹è¯•å„ä¸ªAPIçš„è¿æ¥
- éªŒè¯å›é€€æœºåˆ¶
- æµ‹è¯•å‡çº¿æ•°æ®è®¡ç®—

## å›é€€æœºåˆ¶è¯´æ˜

ç³»ç»ŸæŒ‰ç…§ä»¥ä¸‹é¡ºåºå°è¯•æ•°æ®æº:

1. **ä»·æ ¼æ•°æ®å›é€€é¡ºåº**:
   - æŒ‰`preferred_sources`é¡ºåºå°è¯•
   - å¦‚æœéƒ½å¤±è´¥,å°è¯•æ‰€æœ‰å¯ç”¨çš„æ•°æ®æº

2. **è´¢åŠ¡æ•°æ®å›é€€é¡ºåº**:
   - ä¼˜å…ˆä½¿ç”¨ä»·æ ¼æ•°æ®ç›¸åŒçš„æº
   - å¦‚æœå¤±è´¥,å°è¯•å…¶ä»–æœ‰è´¢åŠ¡æ•°æ®çš„æº
   - å¦‚æœéƒ½å¤±è´¥,ä½¿ç”¨ä»·æ ¼ç§»åŠ¨å¹³å‡ä½œä¸ºå¤‡ç”¨

## å¸¸è§é—®é¢˜

### Q: å¦‚æœTushare Tokenæ²¡æœ‰è®¾ç½®æ€ä¹ˆåŠ?

A: ç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°å…è´¹çš„æ•°æ®æº(yfinanceã€pandas-datareaderæˆ–AKShare),ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚

### Q: å¦‚ä½•çŸ¥é“ä½¿ç”¨äº†å“ªä¸ªæ•°æ®æº?

A: `fetch_complete_data`è¿”å›çš„ç¬¬ä¸‰ä¸ªå‚æ•°åŒ…å«æ•°æ®æºä¿¡æ¯:
```python
df, code, info = fetcher.fetch_complete_data("å¹³å®‰é“¶è¡Œ")
print(info)  # {'price_source': 'akshare', 'finance_source': 'price_ma'}
```

### Q: å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªæ•°æ®æºå—?

A: å¯ä»¥!ä»·æ ¼æ•°æ®å’Œè´¢åŠ¡æ•°æ®å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æºã€‚ä¾‹å¦‚:
- ä»·æ ¼æ•°æ®: AKShare
- è´¢åŠ¡æ•°æ®: Tushare

### Q: å‡çº¿æ•°æ®æ˜¯è‡ªåŠ¨è®¡ç®—çš„å—?

A: æ˜¯çš„,æ‰€æœ‰æ•°æ®æºè·å–çš„ä»·æ ¼æ•°æ®éƒ½ä¼šè‡ªåŠ¨è®¡ç®—MA5ã€MA10ã€MA20ã€MA60å‡çº¿ã€‚

### Q: æ”¯æŒå“ªäº›è‚¡ç¥¨ä»£ç æ ¼å¼?

A: æ”¯æŒ:
- è‚¡ç¥¨åç§°: "å¹³å®‰é“¶è¡Œ"
- 6ä½ä»£ç : "000001"
- yfinanceæ ¼å¼: "000001.SZ" (ä¼šè‡ªåŠ¨è½¬æ¢)

## API Keyè·å–

### Tushare
1. è®¿é—® https://tushare.pro/
2. æ³¨å†Œè´¦å·
3. è·å–Token(éœ€è¦ç§¯åˆ†â‰¥120)

### yfinanceã€pandas-datareaderã€AKShare
- ä¸éœ€è¦API Key,ç›´æ¥ä½¿ç”¨

## æ³¨æ„äº‹é¡¹

1. **APIè°ƒç”¨é™åˆ¶**: Tushareæœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶,è¯·åˆç†ä½¿ç”¨
2. **æ•°æ®è´¨é‡**: Tushareæ•°æ®è´¨é‡æœ€é«˜,ä½†éœ€è¦Token
3. **ç½‘ç»œç¯å¢ƒ**: yfinanceå’Œpandas-datareaderéœ€è¦è®¿é—®Yahoo Finance,å¯èƒ½éœ€è¦ä»£ç†
4. **é”™è¯¯å¤„ç†**: ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†é”™è¯¯å¹¶å›é€€,ä½†å»ºè®®æŸ¥çœ‹æ—¥å¿—äº†è§£å…·ä½“æƒ…å†µ
5. **å‡çº¿è®¡ç®—**: å‡çº¿åŸºäºå‘¨çº¿æ•°æ®è®¡ç®—,å‘¨æœŸä¸ºå‘¨æ•°

## ç¤ºä¾‹è¾“å‡º

```
============================================================
è·å–Aè‚¡æ•°æ®: å¹³å®‰é“¶è¡Œ
============================================================

âœ“ Tushareæ•°æ®è·å–å™¨åˆå§‹åŒ–æˆåŠŸ
âœ“ yfinanceæ•°æ®è·å–å™¨åˆå§‹åŒ–æˆåŠŸ
âœ“ pandas-datareaderæ•°æ®è·å–å™¨åˆå§‹åŒ–æˆåŠŸ
âœ“ AKShareæ•°æ®è·å–å™¨åˆå§‹åŒ–æˆåŠŸ
ğŸ”„ å°è¯•ä½¿ç”¨ tushare è·å–æ•°æ®...
âœ“ æˆåŠŸä½¿ç”¨ tushare è·å– 120 æ¡æ•°æ®
ğŸ”„ å°è¯•ä½¿ç”¨ tushare è·å–è´¢åŠ¡æ•°æ®...
âœ“ æˆåŠŸä½¿ç”¨ tushare è·å–è´¢åŠ¡æ•°æ®

âœ“ æ•°æ®è·å–å®Œæˆ:
  ä»·æ ¼æ•°æ®: tushare (120 æ¡)
  è´¢åŠ¡æ•°æ®: tushare
  å¯¹é½åæ•°æ®: 118 æ¡
  åŒ…å«å‡çº¿: MA5, MA10, MA20, MA60
```

## æ•°æ®æºå¯¹æ¯”

| æ•°æ®æº | éœ€è¦Token | æ•°æ®è´¨é‡ | è´¢åŠ¡æ•°æ® | å‡çº¿è®¡ç®— | æ¨èåº¦ |
|--------|----------|---------|---------|---------|--------|
| Tushare | âœ… | â­â­â­â­â­ | âœ… | âœ… | â­â­â­â­â­ |
| yfinance | âŒ | â­â­â­â­ | âš ï¸ | âœ… | â­â­â­â­ |
| pandas-datareader | âŒ | â­â­â­â­ | âŒ | âœ… | â­â­â­ |
| AKShare | âŒ | â­â­â­â­ | âœ… | âœ… | â­â­â­â­ |

## æ›´æ–°æ—¥å¿—

- 2025-11: é‡æ„ä¸ºAè‚¡ä¸“ç”¨ç‰ˆæœ¬,æ”¯æŒTushareã€yfinanceã€pandas-datareaderã€AKShare,æ·»åŠ å‡çº¿æ•°æ®

## è´¡çŒ®

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®,æ¬¢è¿æäº¤Issueæˆ–Pull Requestã€‚
